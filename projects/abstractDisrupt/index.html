<!DOCTYPE html>
<html>
    <head>
        <title>abstract disrupt</title>

        <style>
            body {
                text-align: center;
                background-color: #2d3638;
            }

            canvas {
                background-color: #1c444f;
            }
        </style>
    </head>

    <body>
        <canvas id="canvas"></canvas>

        <script>
            (function() {
                var lastTime = 0;
                    var vendors = ['ms', 'moz', 'webkit', 'o'];
                for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                    window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
                    window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
                                               || window[vendors[x]+'CancelRequestAnimationFrame'];
                }

                if (!window.requestAnimationFrame)
                    window.requestAnimationFrame = function(callback, element) {
                        var currTime = new Date().getTime();
                        var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                        var id = window.setTimeout(function() { callback(currTime + timeToCall); },
                          timeToCall);
                        lastTime = currTime + timeToCall;
                        return id;
                    };

                if (!window.cancelAnimationFrame)
                    window.cancelAnimationFrame = function(id) {
                        clearTimeout(id);
                    };
            }());

            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");
            canvas.width = 100; // all values in the game are with respect to this
            canvas.height = parseInt(canvas.width / 1.111111111); // ratio of the game boy screen (160 x 144)

            var lastTime;

            function Player() {
                var speed = canvas.width / 5;

                this.size = canvas.width / 32;
                this.x = canvas.width / 2 - this.size / 2;
                this.y = canvas.height / 2 - this.size / 2;

                this.right = false;
                this.left = false;
                this.up = false;
                this.down = false;

                this.draw = function() {
                    context.beginPath();
                    context.rect(this.x, this.y, this.size, this.size);
                    context.fillStyle = "#c74b28";
                    context.strokeStyle = "#CF5330";
                    context.fill();
                    context.stroke();
                }

                this.update = function(delta) {
                    if (this.right) this.x += speed * delta;
                    if (this.left) this.x -= speed * delta;
                    if (this.up) this.y -= speed * delta;
                    if (this.down) this.y += speed * delta;
                }
            }

            var player = new Player();

            function loop() {
                requestAnimationFrame(loop);

                update();
                draw();
            } loop();

            function update() {
                var currentTime = new Date().getTime();
                var delta = (currentTime - (lastTime || currentTime)) / 1000;
                lastTime = currentTime;
                player.update(delta);
            }

            function draw() {
                context.clearRect(0, 0, canvas.width, canvas.height);
                player.draw();
            }

            window.onblur = function() {
                player.right = false;
                player.left = false;
            }

            document.addEventListener("keydown", function(e) {
                if (e.keyCode === 37) player.left = true;
                if (e.keyCode === 38) player.up = true;
                if (e.keyCode === 39) player.right = true;
                if (e.keyCode === 40) player.down = true;
            });

            document.addEventListener("keyup", function(e) {
                if (e.keyCode === 37) player.left = false;
                if (e.keyCode === 38) player.up = false;
                if (e.keyCode === 39) player.right = false;
                if (e.keyCode === 40) player.down = false;
            });
        </script>
    </body>
</html>
